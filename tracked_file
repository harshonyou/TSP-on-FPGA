#include <stdio.h>
#include "platform.h"
#include "xil_printf.h"
#include "xparameters.h"
#include "xtoplevel.h"
#include "xil_cache.h"

#define NUMDATA 100
u32 shared[NUMDATA];

int main() {
    int i;
    XToplevel hls;

    init_platform();
    Xil_DCacheDisable();

    print("\nHLS test\n");
    for(i = 0; i < NUMDATA; i++) {
        shared[i] = i;
    }
    shared[0] = 8000;

    if (XToplevel_Initialize(&hls, XPAR_TOPLEVEL_0_DEVICE_ID) != XST_SUCCESS) {
        xil_printf("HLS Initialization failed\n");
        return XST_FAILURE;
    }

    XToplevel_Set_ram(&hls, (u32) shared);
    XToplevel_Start(&hls);
    while(!XToplevel_IsDone(&hls));

    u32 arg2 = XToplevel_Get_arg2(&hls);
    u32 arg3 = XToplevel_Get_arg3(&hls);

    printf("arg2 = %lu\narg3 = %lu\n", arg2, arg3);

    if (arg2 == 12950 && arg3 == 3050) {
        xil_printf("Test Passed\n");
    } else {
        xil_printf("Test Failed\n");
    }

    cleanup_platform();
    return 0;
}
